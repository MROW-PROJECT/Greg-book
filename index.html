<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Greg Book - Independent Third-Party Cruise Booking V5</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Base */
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", sans-serif;
        -webkit-font-smoothing: antialiased;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      /*
        Selection & copy behavior:
        - Allow normal selection and copy/paste interaction inside form controls and designated selectable elements.
        - Prevent accidental selection on non-interactive UI chrome (cards, labels, buttons).
      */

      /* Prevent selection on UI chrome (cards/buttons/labels) */
      .card-hover,
      button,
      label,
      .checkbox-label,
      .no-select {
        -webkit-user-select: none;
        user-select: none;
        -webkit-touch-callout: none; /* iOS Safari */
      }

      /* Allow selection and normal caret behavior inside form fields and selectable text */
      input,
      textarea,
      select,
      option,
      #booking-id,
      .allow-select {
        -webkit-user-select: text;
        user-select: text;
        -webkit-touch-callout: text; /* iOS Safari */
      }

      /* Small niceties */
      .glass {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      }

      /* Normal visible selection */
      ::selection {
        background: rgba(96, 165, 250, 0.35);
        color: inherit;
      }

      /* Make small interactive controls show pointer */
      button,
      .checkbox-label {
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      // Icons
      const Ship = ({ size = 24, className = "" }) => (
        <svg
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1" />
          <path d="M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.94 5.34 2.81 7.76" />
          <path d="M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6" />
          <path d="M12 10v4" />
          <path d="M12 2v3" />
        </svg>
      );

      const Calendar = ({ size = 24, className = "" }) => (
        <svg
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
          <line x1="16" y1="2" x2="16" y2="6" />
          <line x1="8" y1="2" x2="8" y2="6" />
          <line x1="3" y1="10" x2="21" y2="10" />
        </svg>
      );

      const Users = ({ size = 24, className = "" }) => (
        <svg
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
          <circle cx="9" cy="7" r="4" />
          <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
          <path d="M16 3.13a4 4 0 0 1 0 7.75" />
        </svg>
      );

      const CreditCard = ({ size = 24, className = "" }) => (
        <svg
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
          <line x1="1" y1="10" x2="23" y2="10" />
        </svg>
      );

      const CheckCircle = ({ size = 24, className = "" }) => (
        <svg
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
          <polyline points="22 4 12 14.01 9 11.01" />
        </svg>
      );

      const Anchor = ({ size = 24, className = "" }) => (
        <svg
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <circle cx="12" cy="5" r="3" />
          <line x1="12" y1="22" x2="12" y2="8" />
          <path d="M5 12H2a10 10 0 0 0 20 0h-3" />
        </svg>
      );

      const AlertCircle = ({ size = 24, className = "" }) => (
        <svg
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="8" x2="12" y2="12" />
          <line x1="12" y1="16" x2="12.01" y2="16" />
        </svg>
      );

      const Home = ({ size = 24, className = "" }) => (
        <svg
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" />
        </svg>
      );

      const GregBookCruise = () => {
        const [activeTab, setActiveTab] = useState("dashboard");
        const [currentPage, setCurrentPage] = useState("overview");
        const [formData, setFormData] = useState({
          cruiseLine: "CR Cruises",
          region: "",
          port: "",
          ship: "",
          itinerary: "",
          nights: "",
          departure: "",
          sailingDate: "",
          guests: 2,
          roomType: "",
          robloxUsername: "",
          discordUsername: "",
          cardNumber: "",
          expiryDate: "",
          cvv: "",
          cardName: "",
          agreedTerms: false,
          agreedThirdParty: false,
          agreedRoomSubject: false,
          agreedNonRefundable: false,
          agreedPriceChanges: false,
          agreedDocumentation: false,
          agreedInsurance: false,
        });
        const [bookingStatus, setBookingStatus] = useState(null);
        const [isSubmitting, setIsSubmitting] = useState(false);
        const [bookingId, setBookingId] = useState(null); // persistent booking id for confirmation and selection

        // Full cruiseData - all original CR ships retained, each labeled cruiseLine:"CR Cruises".
        // Added Grand Cruises ships (Grand Discovery and Grand Adventure) with exact available dates you requested.
        // Added the two cruises from the provided images and added CR Star 4-night & 5-night Miami departures.
        // Updated CR Adventure ports/schedule: Port Canaveral (now -> Sep 2026), then Port Everglades in September 2026.
        const cruiseData = {
          "CR Odyssey": {
            itinerary: "Round Trip Bahamas Cruise",
            nights: "7",
            ports: ["Port of New York, NY"],
            region: "Bahamas",
            price: 2100,
            portsOfCall:
              "Port Of New York - Port Canaveral - Nassau - Ocean's Edge - Port Of New York",
            cruiseLine: "CR Cruises",
          },
          "CR Sentient": {
            itinerary: "Hawaii & Honolulu Cruise",
            nights: "17",
            ports: ["Port Mirage Bay, AZ"],
            region: "Hawaii",
            price: 3800,
            portsOfCall:
              "Port Mirage Bay - Honolulu, Oahu - Kona - Port Mirage Bay",
            cruiseLine: "CR Cruises",
          },
          "CR Pride Of America": {
            itinerary: "Hawaii & Honolulu Cruise",
            nights: "19",
            ports: ["Port Mirage Bay, AZ"],
            region: "Hawaii",
            price: 3400,
            portsOfCall:
              "Port Mirage Bay - Ensenada - Honolulu, Oahu - Kona - Port Mirage Bay",
            cruiseLine: "CR Cruises",
          },
          // Updated CR Orion to match the image: 5-night Catalina & Ensenada, sailing Feb 2026 - Nov 2026
          "CR Orion": {
            itinerary: "Catalina & Ensenada Cruise",
            nights: "5", // updated from 3 -> 5 (per image)
            ports: ["Port Mirage Bay, AZ", "Ensenada, MX", "Port Lumina, AZ"],
            region: "Catalina",
            price: 110,
            portsOfCall:
              "Port Mirage Bay - Ensenada - Port Lumina - Port Mirage Bay",
            cruiseLine: "CR Cruises",
            sailingRange: "Feb 2026 - Nov 2026",
          },
          "CR Dawn": {
            itinerary: "Catalina & Ensenada Cruise",
            nights: "3",
            ports: ["Port Mirage Bay, AZ"],
            region: "Catalina",
            price: 116,
            portsOfCall: "Port Mirage Bay - Catalina Island - Port Mirage Bay",
            cruiseLine: "CR Cruises",
          },
          "CR Riviera": {
            itinerary: "Catalina & Ensenada Cruise",
            nights: "4",
            ports: ["Port Mirage Bay, AZ"],
            region: "Mexico",
            price: 400,
            portsOfCall: "Port Mirage Bay - Cabo San Lucas - Port Mirage Bay",
            cruiseLine: "CR Cruises",
          },
          "CR Pacific Dream": {
            itinerary: "Catalina & Ensenada Cruise",
            nights: "5",
            ports: ["Port Mirage Bay, AZ"],
            region: "Mexico",
            price: 988,
            portsOfCall:
              "Port Mirage Bay - Cabo San Lucas - Mazatlan - Puerto Vallarta - Port Mirage Bay",
            cruiseLine: "CR Cruises",
          },
          "CR Pacific Mariner": {
            itinerary: "Catalina & Ensenada Cruise",
            nights: "9",
            ports: ["Port Mirage Bay, AZ"],
            region: "Mexico",
            price: 991,
            portsOfCall:
              "Port Mirage Bay - Catalina Island - Ensenada - Cabo San Lucas - Mazatlan - Puerto Vallarta - Port Mirage Bay",
            cruiseLine: "CR Cruises",
          },
          "CR Legacy": {
            itinerary: "Catalina & Ensenada Cruise",
            nights: "9",
            ports: ["Port Mirage Bay, AZ"],
            region: "Mexico",
            price: 1617,
            portsOfCall:
              "Port Mirage Bay - Ensenada - Cabo San Lucas - Port Mirage Bay",
            cruiseLine: "CR Cruises",
            sailingRange: "Mar 2026 - Nov 2026",
          },
          "CR Solstice": {
            itinerary: "Catalina & Ensenada Cruise",
            nights: "7",
            ports: ["Port Mirage Bay, AZ"],
            region: "Mexico",
            price: 1170,
            portsOfCall:
              "Port Mirage Bay - Catalina Island - Ensenada - Cabo San Lucas - Mazatlan - Puerto Vallarta - Port Mirage Bay",
            cruiseLine: "CR Cruises",
          },
          "CR Essence of the Seas": {
            itinerary: "Catalina & Ensenada Cruise",
            nights: "9",
            ports: ["Port Mirage Bay, AZ"],
            region: "Mexico",
            price: 1099,
            portsOfCall:
              "Port Mirage Bay - Catalina Island - Ensenada - Cabo San Lucas - Mazatlan - Puerto Vallarta - Port Mirage Bay",
            cruiseLine: "CR Cruises",
          },
          "CR Jadeite of the Seas": {
            itinerary: "Catalina & Ensenada Cruise",
            nights: "7",
            ports: ["Port Mirage Bay, AZ"],
            region: "Mexico",
            price: 2700,
            portsOfCall:
              "Port Mirage Bay - Catalina Island - Ensenada - Cabo San Lucas - Port Mirage Bay",
            cruiseLine: "CR Cruises",
          },
          "CR Galaxy": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "4",
            ports: ["Port Canaveral, FL"],
            region: "Bahamas",
            price: 199,
            portsOfCall:
              "Port Canaveral - Key West - Ocean's Edge - Port Canaveral",
            cruiseLine: "CR Cruises",
          },
          "CR Treasure": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "4",
            ports: ["Port Everglades, FL"],
            region: "Bahamas",
            price: 215,
            portsOfCall:
              "Port Everglades - Key West - Ocean's Edge - Port Everglades",
            cruiseLine: "CR Cruises",
          },
          "CR Tropical": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "4",
            ports: ["Port Canaveral, FL"],
            region: "Bahamas",
            price: 210,
            portsOfCall:
              "Port Canaveral - Key West - Ocean's Edge - Port Canaveral",
            cruiseLine: "CR Cruises",
          },
          // CR Adventure: schedule change per request:
          // - From now until end of September 2026 -> Port Canaveral departures
          // - From September 2026 (the month of Sep) -> Port Everglades departures
          "CR Adventure": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "3",
            // default ports list contains the current/primary port first; include both to let user choose historic ports if needed
            ports: ["Port Canaveral, FL", "Port Everglades, FL"],
            region: "Bahamas",
            price: 777,
            portsOfCall:
              "Port Canaveral - Nassau - Ocean's Edge - Port Canaveral",
            cruiseLine: "CR Cruises",
            // availability schedule (used by the UI if desired)
            availabilitySchedule: [
              {
                from: "2026-01-24",
                to: "2026-09-30",
                port: "Port Canaveral, FL",
                note: "Port Canaveral departures (now until end of Sep 2026)",
              },
              {
                from: "2026-09-01",
                to: "2026-12-31",
                port: "Port Everglades, FL",
                note: "Port Everglades departures starting Sep 2026",
              },
            ],
          },
          // Keep existing CR Star but add 4-night and 5-night Miami departures per request
          "CR Star": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "3",
            ports: ["Port Canaveral, FL"],
            region: "Bahamas",
            price: 1161,
            portsOfCall:
              "Port Canaveral - Nassau - Ocean's Edge - Port Canaveral",
            cruiseLine: "CR Cruises",
          },
          // New variants for CR Star 4-night and 5-night out of Miami
          "CR Star (4-Night)": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "4",
            ports: ["Port Miami, FL"],
            region: "Bahamas",
            price: 1161, // kept same base price for 4-night variant (adjustable)
            portsOfCall:
              "Port Miami - Nassau - Ocean's Edge - Port Miami",
            cruiseLine: "CR Cruises",
          },
          "CR Star (5-Night)": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "5",
            ports: ["Port Miami, FL"],
            region: "Bahamas",
            price: 1499, // estimated 5-night price (adjustable)
            portsOfCall:
              "Port Miami - Nassau - Freeport - Ocean's Edge - Port Miami",
            cruiseLine: "CR Cruises",
          },
          "CR Dream": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "4",
            ports: ["Port Canaveral, FL"],
            region: "Bahamas",
            price: 1499,
            portsOfCall:
              "Port Canaveral - Nassau - Ocean's Edge - Port Canaveral",
            cruiseLine: "CR Cruises",
          },
          "CR Encore": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "4",
            ports: ["Port Everglades, FL"],
            region: "Bahamas",
            price: 1050,
            portsOfCall:
              "Port Everglades - Nassau - Ocean's Edge - Port Everglades",
            cruiseLine: "CR Cruises",
          },
          "CR Caribbean": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "7",
            ports: ["Port Canaveral, FL"],
            region: "Bahamas",
            price: 1100,
            portsOfCall:
              "Port Canaveral - Nassau - Freeport - Bimini - Key West - Ocean's Edge - Port Canaveral",
            cruiseLine: "CR Cruises",
          },
          "CR Emerald of the Seas": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "6",
            ports: ["Port Canaveral, FL"],
            region: "Bahamas",
            price: 1200,
            portsOfCall:
              "Port Canaveral - Nassau - Key West - Ocean's Edge - Port Canaveral",
            cruiseLine: "CR Cruises",
          },
          "CR Diamond of the Seas": {
            itinerary: "Bahamas: Ocean's Edge & Nassau",
            nights: "9",
            ports: ["Port Miami, FL"],
            region: "Bahamas",
            price: 1900,
            portsOfCall:
              "Port Miami - Nassau - Freeport - Bimini - Ocean's Edge - Port Miami",
            cruiseLine: "CR Cruises",
          },

          // Grand Cruises ships added (do not remove any CR ships)
          "Grand Discovery": {
            itinerary: "Maiden Voyage 4-Night Bahamian Cruise",
            nights: "4",
            ports: ["Port Canaveral, FL"],
            region: "Bahamas",
            price: 1299,
            portsOfCall:
              "Port Canaveral - Nassau - Horizon Cay - Sea - Port Canaveral",
            cruiseLine: "Grand Cruises",
            availableDates: ["Mar 10, 2026 05:30 EST"], // exact date/time requested
          },
          "Grand Adventure": {
            itinerary: "Maiden Voyage 7-Night Eastern Caribbean Cruise",
            nights: "7",
            ports: ["Port Canaveral, FL"],
            region: "Eastern Caribbean",
            price: 2499,
            portsOfCall:
              "Port Canaveral - Sea - Sea - Tortola - Grand Turk - Sea - Horizon Cay - Port Canaveral",
            cruiseLine: "Grand Cruises",
            availableDates: ["Jun 22, 2026 05:30 EST"], // exact date/time requested
          },
        };

        const regions = [
          "Bahamas",
          "Catalina",
          "Mexico",
          "Hawaii",
          "Eastern Caribbean",
        ];
        const roomTypes = [
          { type: "Interior", price: 1 },
          { type: "Ocean View", price: 1.2 },
          { type: "Balcony", price: 1.5 },
          { type: "Suite", price: 2 },
        ];

        const calculateTotal = () => {
          const room = roomTypes.find((r) => r.type === formData.roomType);
          const shipData = cruiseData[formData.ship];
          if (!room || !shipData) return 0;
          return shipData.price * room.price * formData.guests;
        };

        // Utility: get the "current" port for a ship if an availabilitySchedule is provided
        const getCurrentPortForShip = (shipKey) => {
          const ship = cruiseData[shipKey];
          if (!ship || !ship.availabilitySchedule) return ship?.ports?.[0] || "";
          const now = new Date(); // uses client's clock
          for (const slot of ship.availabilitySchedule) {
            const from = slot.from ? new Date(slot.from) : null;
            const to = slot.to ? new Date(slot.to) : null;
            // If both from/to exist, check if now is inside. If only from exists, check >= from.
            if (
              (from === null || now >= from) &&
              (to === null || now <= to)
            ) {
              return slot.port || ship.ports?.[0] || "";
            }
          }
          // fallback to the first port if schedule doesn't match
          return ship.ports?.[0] || "";
        };

        // Respect cruiseLine when listing ships and ports; fallback default stays "CR Cruises"
        const getAvailableShips = () => {
          const line = formData.cruiseLine || "CR Cruises";
          if (!formData.region) {
            return Object.keys(cruiseData).filter(
              (ship) => (cruiseData[ship].cruiseLine || "CR Cruises") === line
            );
          }
          return Object.keys(cruiseData).filter(
            (ship) =>
              cruiseData[ship].region === formData.region &&
              (cruiseData[ship].cruiseLine || "CR Cruises") === line
          );
        };

        const getAvailablePorts = () => {
          const line = formData.cruiseLine || "CR Cruises";
          if (!formData.region) {
            return [
              ...new Set(
                Object.keys(cruiseData)
                  .filter(
                    (s) => (cruiseData[s].cruiseLine || "CR Cruises") === line
                  )
                  .flatMap((ship) => {
                    // if ship has an availability schedule prefer the current port for listing
                    const current = getCurrentPortForShip(ship);
                    return current ? [current] : (cruiseData[ship].ports || []);
                  })
              ),
            ];
          }
          const shipsInRegion = Object.values(cruiseData).filter(
            (ship) =>
              ship.region === formData.region &&
              (ship.cruiseLine || "CR Cruises") === line
          );
          return [
            ...new Set(
              shipsInRegion.flatMap((ship) =>
                ship.availabilitySchedule
                  ? [getCurrentPortForShip(Object.keys(cruiseData).find(k => cruiseData[k] === ship))]
                  : ship.ports
              )
            ),
          ];
        };

        const sendWebhook = (bookingData, id) => {
          const webhookUrl =
            "https://discord.com/api/webhooks/1462305721080221847/65dPZEh2o2vUyew4XT6EV1eQSgufkHqowH166Z_W8Y6tR1tUwE7sOfh4NxJJMEEXHgtM";
          const total = calculateTotal();

          const payload = {
            embeds: [
              {
                title: "ðŸš¢ New Cruise Booking",
                color: 3066993,
                fields: [
                  { name: "Booking ID", value: id, inline: false },
                  {
                    name: "Cruise Line",
                    value: bookingData.cruiseLine || "CR Cruises",
                    inline: true,
                  },
                  {
                    name: "ðŸ‘¤ Roblox Username",
                    value: bookingData.robloxUsername,
                    inline: true,
                  },
                  {
                    name: "ðŸ’¬ Discord Username",
                    value: bookingData.discordUsername,
                    inline: true,
                  },
                  {
                    name: "ðŸ“… Sailing Date",
                    value: bookingData.sailingDate,
                    inline: true,
                  },
                  { name: "ðŸš¢ Ship", value: bookingData.ship, inline: true },
                  {
                    name: "ðŸ—ºï¸ Itinerary",
                    value: bookingData.itinerary,
                    inline: true,
                  },
                  { name: "âš“ Port", value: bookingData.port, inline: true },
                  {
                    name: "ðŸŒŽ Region",
                    value: bookingData.region,
                    inline: true,
                  },
                  {
                    name: "ðŸŒ™ Duration",
                    value: `${bookingData.nights} nights`,
                    inline: true,
                  },
                  {
                    name: "ðŸ‘¥ Guests",
                    value: bookingData.guests.toString(),
                    inline: true,
                  },
                  {
                    name: "ðŸ›ï¸ Room Type",
                    value: bookingData.roomType,
                    inline: true,
                  },
                  {
                    name: "ðŸ’° Total Amount",
                    value: `$${total.toFixed(2)}`,
                    inline: false,
                  },
                ],
                timestamp: new Date().toISOString(),
                footer: { text: "Greg Book - Third-Party Cruise Booking" },
              },
            ],
          };

          fetch(webhookUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          }).catch(() => {});
        };

        const handleSubmit = () => {
          const allAgreed =
            formData.agreedTerms &&
            formData.agreedThirdParty &&
            formData.agreedRoomSubject &&
            formData.agreedNonRefundable &&
            formData.agreedPriceChanges &&
            formData.agreedDocumentation &&
            formData.agreedInsurance;

          if (!allAgreed) {
            alert(
              "Please agree to all terms and conditions before confirming your booking"
            );
            return;
          }

          setIsSubmitting(true);
          const id = `GB-${Date.now()}`;
          setBookingId(id);
          sendWebhook(formData, id);

          setTimeout(() => {
            setIsSubmitting(false);
            setBookingStatus("success");
            setCurrentPage("confirmation");
          }, 1500);
        };

        const canProceed = () => {
          switch (currentPage) {
            case "overview":
              return (
                formData.ship &&
                formData.itinerary &&
                formData.nights &&
                formData.departure
              );
            case "sailing":
              return formData.sailingDate;
            case "guests":
              return (
                formData.guests &&
                formData.roomType &&
                formData.robloxUsername.trim() &&
                formData.discordUsername.trim()
              );
            case "payment":
              return (
                formData.cardNumber &&
                formData.expiryDate &&
                formData.cvv &&
                formData.cardName &&
                formData.agreedTerms &&
                formData.agreedThirdParty &&
                formData.agreedRoomSubject &&
                formData.agreedNonRefundable &&
                formData.agreedPriceChanges &&
                formData.agreedDocumentation &&
                formData.agreedInsurance
              );
            default:
              return false;
          }
        };

        // Dashboard Content
        const DashboardContent = () => (
          <div className="space-y-6">
            <div className="grid md:grid-cols-3 gap-6">
              <div className="bg-white rounded-xl p-6 shadow-lg card-hover">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-500 text-sm">Total Ships</p>
                    <h3 className="text-3xl font-bold text-gray-800 mt-1">
                      {Object.keys(cruiseData).length}
                    </h3>
                  </div>
                  <Ship size={40} className="text-blue-500" />
                </div>
              </div>

              <div className="bg-white rounded-xl p-6 shadow-lg card-hover">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-500 text-sm">Available Routes</p>
                    <h3 className="text-3xl font-bold text-gray-800 mt-1">4</h3>
                  </div>
                  <Calendar size={40} className="text-green-500" />
                </div>
              </div>

              <div className="bg-white rounded-xl p-6 shadow-lg card-hover">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-500 text-sm">Starting From</p>
                    <h3 className="text-3xl font-bold text-gray-800 mt-1">
                      $110
                    </h3>
                  </div>
                  <CreditCard size={40} className="text-purple-500" />
                </div>
              </div>
            </div>

            <div className="bg-white rounded-xl p-8 shadow-lg">
              <h2 className="text-2xl font-bold mb-6">Featured Destinations</h2>
              <div className="grid md:grid-cols-2 gap-6">
                {regions.map((region) => {
                  const shipsInRegion = Object.values(cruiseData).filter(
                    (ship) => ship.region === region
                  );
                  const minPrice = shipsInRegion.length
                    ? Math.min(...shipsInRegion.map((ship) => ship.price))
                    : 0;

                  return (
                    <div
                      key={region}
                      className="border-2 border-gray-200 rounded-xl p-6 hover:border-blue-500 transition cursor-pointer"
                      onClick={() => {
                        setActiveTab("booking");
                        setFormData({
                          ...formData,
                          region: region,
                          ship: "",
                          port: "",
                        });
                        setCurrentPage("overview");
                      }}
                    >
                      <h3 className="text-xl font-bold mb-2">{region}</h3>
                      <p className="text-gray-600 mb-4">
                        {shipsInRegion.length} ships available
                      </p>
                      <p className="text-2xl font-bold text-blue-600">
                        From ${minPrice}
                      </p>
                    </div>
                  );
                })}
              </div>
            </div>

            <div className="bg-white rounded-xl p-8 shadow-lg">
              <h2 className="text-2xl font-bold mb-6">Why Choose Greg Book?</h2>
              <div className="grid md:grid-cols-3 gap-6">
                <div className="text-center">
                  <div className="bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <Ship size={32} className="text-blue-600" />
                  </div>
                  <h3 className="font-bold mb-2">Wide Selection</h3>
                  <p className="text-gray-600 text-sm">
                    Multiple ships across multiple lines
                  </p>
                </div>
                <div className="text-center">
                  <div className="bg-green-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <CheckCircle size={32} className="text-green-600" />
                  </div>
                  <h3 className="font-bold mb-2">Best Prices</h3>
                  <p className="text-gray-600 text-sm">
                    Competitive rates guaranteed
                  </p>
                </div>
                <div className="text-center">
                  <div className="bg-purple-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <Users size={32} className="text-purple-600" />
                  </div>
                  <h3 className="font-bold mb-2">Easy Booking</h3>
                  <p className="text-gray-600 text-sm">
                    Simple multi-step process
                  </p>
                </div>
              </div>
            </div>
          </div>
        );

        // Booking Flow Components
        const ProgressBar = () => {
          const pages = [
            "overview",
            "sailing",
            "guests",
            "payment",
            "confirmation",
          ];
          const currentIndex = pages.indexOf(currentPage);

          return (
            <div className="mb-8">
              <div className="flex items-center justify-between">
                {pages.map((page, idx) => (
                  <React.Fragment key={page}>
                    <div className="flex flex-col items-center">
                      <div
                        className={`w-10 h-10 rounded-full flex items-center justify-center font-semibold ${
                          idx <= currentIndex
                            ? "bg-blue-600 text-white"
                            : "bg-gray-200 text-gray-500"
                        }`}
                      >
                        {idx + 1}
                      </div>
                      <span className="text-xs mt-2 capitalize">{page}</span>
                    </div>
                    {idx < pages.length - 1 && (
                      <div
                        className={`flex-1 h-1 mx-2 ${
                          idx < currentIndex ? "bg-blue-600" : "bg-gray-200"
                        }`}
                      />
                    )}
                  </React.Fragment>
                ))}
              </div>
            </div>
          );
        };

        // OverviewPage: Cruise Line selector + editable textboxes (itinerary/nights editable)
        const OverviewPage = () => (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold flex items-center gap-2">
              <Ship size={24} className="text-blue-600" />
              Cruise Overview
            </h2>

            <div className="grid md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-2">
                  Cruise Line
                </label>
                <select
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={formData.cruiseLine}
                  onChange={(e) =>
                    setFormData({
                      ...formData,
                      cruiseLine: e.target.value,
                      ship: "",
                      port: "",
                    })
                  }
                >
                  <option value="CR Cruises">CR Cruises</option>
                  <option value="Grand Cruises">Grand Cruises</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Departure Port
                </label>
                <select
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={formData.port}
                  onChange={(e) =>
                    setFormData({ ...formData, port: e.target.value, ship: "" })
                  }
                  disabled={!formData.region}
                >
                  <option value="">Select Port</option>
                  {getAvailablePorts().map((p) => (
                    <option key={p} value={p}>
                      {p}
                    </option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">Ship</label>
                <select
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={formData.ship}
                  onChange={(e) => {
                    const selectedShip = e.target.value;
                    const shipData = cruiseData[selectedShip];
                    // If ship has availabilitySchedule, pick the current port for default
                    const defaultPort = shipData?.availabilitySchedule
                      ? getCurrentPortForShip(selectedShip)
                      : shipData?.ports?.[0] || formData.port;
                    setFormData({
                      ...formData,
                      ship: selectedShip,
                      itinerary: shipData?.itinerary || "",
                      nights: shipData?.nights || "",
                      port: defaultPort,
                      sailingDate: "", // reset selected date when changing ship
                    });
                  }}
                  disabled={!formData.region}
                >
                  <option value="">Select Ship</option>
                  {getAvailableShips().map((s) => (
                    <option key={s} value={s}>
                      {s}
                    </option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Itinerary
                </label>
                <input
                  type="text"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-white"
                  value={formData.itinerary}
                  onChange={(e) =>
                    setFormData({ ...formData, itinerary: e.target.value })
                  }
                  placeholder="Itinerary (editable)"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">Nights</label>
                <input
                  type="text"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-white"
                  value={formData.nights}
                  onChange={(e) =>
                    setFormData({ ...formData, nights: e.target.value })
                  }
                  placeholder="Number of nights"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Departure Month
                </label>
                <select
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={formData.departure}
                  onChange={(e) =>
                    setFormData({ ...formData, departure: e.target.value })
                  }
                >
                  <option value="">Select Month</option>
                  <option value="Feb 2026">February 2026</option>
                  <option value="Mar 2026">March 2026</option>
                  <option value="Apr 2026">April 2026</option>
                  <option value="May 2026">May 2026</option>
                  <option value="Jun 2026">June 2026</option>
                  <option value="Jul 2026">July 2026</option>
                  <option value="Aug 2026">August 2026</option>
                  <option value="Sep 2026">September 2026</option>
                </select>
              </div>
            </div>
          </div>
        );

        // SailingPage: uses ship-specific availableDates when present (Grand ships use the exact dates provided)
        const SailingPage = () => {
          const defaultDates = [
            "Feb 10, 2026",
            "Feb 17, 2026",
            "Mar 10, 2026",
            "Apr 07, 2026",
            "May 05, 2026",
            "Jun 02, 2026",
            "Jul 01, 2026",
            "Aug 05, 2026",
            "Sep 08, 2026",
          ];

          // If ship provides specific availableDates (e.g., Grand Cruises), use those.
          const shipData = cruiseData[formData.ship];
          const availableDates = shipData?.availableDates || defaultDates;

          return (
            <div className="space-y-6">
              <h2 className="text-2xl font-bold flex items-center gap-2">
                <Calendar size={24} className="text-green-600" />
                Sailing Dates
              </h2>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Select Sailing Date
                </label>
                <select
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={formData.sailingDate}
                  onChange={(e) =>
                    setFormData({ ...formData, sailingDate: e.target.value })
                  }
                >
                  <option value="">Select Date</option>
                  {availableDates.map((d) => (
                    <option key={d} value={d}>
                      {d}
                    </option>
                  ))}
                </select>
                {shipData?.sailingRange && (
                  <p className="text-xs text-gray-500 mt-2">
                    Sailings: {shipData.sailingRange}
                  </p>
                )}
                {shipData?.availabilitySchedule && (
                  <div className="text-xs text-gray-600 mt-2">
                    <strong>Schedule:</strong>
                    <ul className="list-disc ml-5">
                      {shipData.availabilitySchedule.map((s, idx) => (
                        <li key={idx}>
                          {s.from} â†’ {s.to} : {s.port} {s.note ? `(${s.note})` : ""}
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
              </div>
            </div>
          );
        };

        // GuestsPage, PaymentPage, ConfirmationPage remain unchanged (omitted here for brevity),
        // but are present in the full file below so the app still works as before.
        // (Continue with the same components from the original file...)

        const GuestsPage = () => (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold flex items-center gap-2">
              <Users size={24} className="text-purple-600" />
              Guests & Room
            </h2>

            <div className="grid md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-2">Guests</label>
                <input
                  type="number"
                  min="1"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-white"
                  value={formData.guests}
                  onChange={(e) =>
                    setFormData({ ...formData, guests: Number(e.target.value) })
                  }
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Room Type
                </label>
                <select
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={formData.roomType}
                  onChange={(e) =>
                    setFormData({ ...formData, roomType: e.target.value })
                  }
                >
                  <option value="">Select Room Type</option>
                  {roomTypes.map((r) => (
                    <option key={r.type} value={r.type}>
                      {r.type}
                    </option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Roblox Username
                </label>
                <input
                  type="text"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-white"
                  value={formData.robloxUsername}
                  onChange={(e) =>
                    setFormData({ ...formData, robloxUsername: e.target.value })
                  }
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Discord Username
                </label>
                <input
                  type="text"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-white"
                  value={formData.discordUsername}
                  onChange={(e) =>
                    setFormData({ ...formData, discordUsername: e.target.value })
                  }
                />
              </div>
            </div>
          </div>
        );

        const PaymentPage = () => (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold flex items-center gap-2">
              <CreditCard size={24} className="text-purple-600" />
              Payment
            </h2>

            <div className="grid md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-2">
                  Card Number
                </label>
                <input
                  type="text"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-white"
                  value={formData.cardNumber}
                  onChange={(e) =>
                    setFormData({ ...formData, cardNumber: e.target.value })
                  }
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Expiry Date
                </label>
                <input
                  type="text"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-white"
                  value={formData.expiryDate}
                  onChange={(e) =>
                    setFormData({ ...formData, expiryDate: e.target.value })
                  }
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">CVV</label>
                <input
                  type="text"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-white"
                  value={formData.cvv}
                  onChange={(e) =>
                    setFormData({ ...formData, cvv: e.target.value })
                  }
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">Name on Card</label>
                <input
                  type="text"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-white"
                  value={formData.cardName}
                  onChange={(e) =>
                    setFormData({ ...formData, cardName: e.target.value })
                  }
                />
              </div>
            </div>

            <div className="bg-white p-4 rounded-lg border border-gray-200">
              <h3 className="font-semibold mb-2">Terms & Agreements</h3>
              <div className="grid gap-2">
                <label className="checkbox-label flex items-center space-x-2">
                  <input
                    type="checkbox"
                    checked={formData.agreedTerms}
                    onChange={(e) =>
                      setFormData({ ...formData, agreedTerms: e.target.checked })
                    }
                  />
                  <span>I agree to the terms and conditions</span>
                </label>

                <label className="checkbox-label flex items-center space-x-2">
                  <input
                    type="checkbox"
                    checked={formData.agreedThirdParty}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        agreedThirdParty: e.target.checked,
                      })
                    }
                  />
                  <span>I agree to third-party booking terms</span>
                </label>

                <label className="checkbox-label flex items-center space-x-2">
                  <input
                    type="checkbox"
                    checked={formData.agreedRoomSubject}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        agreedRoomSubject: e.target.checked,
                      })
                    }
                  />
                  <span>Rooms subject to availability</span>
                </label>

                <label className="checkbox-label flex items-center space-x-2">
                  <input
                    type="checkbox"
                    checked={formData.agreedNonRefundable}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        agreedNonRefundable: e.target.checked,
                      })
                    }
                  />
                  <span>Non-refundable booking acknowledgement</span>
                </label>

                <label className="checkbox-label flex items-center space-x-2">
                  <input
                    type="checkbox"
                    checked={formData.agreedPriceChanges}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        agreedPriceChanges: e.target.checked,
                      })
                    }
                  />
                  <span>Prices may change until paid in full</span>
                </label>

                <label className="checkbox-label flex items-center space-x-2">
                  <input
                    type="checkbox"
                    checked={formData.agreedDocumentation}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        agreedDocumentation: e.target.checked,
                      })
                    }
                  />
                  <span>Documentation & travel rules required</span>
                </label>

                <label className="checkbox-label flex items-center space-x-2">
                  <input
                    type="checkbox"
                    checked={formData.agreedInsurance}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        agreedInsurance: e.target.checked,
                      })
                    }
                  />
                  <span>Recommended travel insurance acknowledged</span>
                </label>
              </div>
            </div>
          </div>
        );

        const ConfirmationPage = () => (
          <div className="space-y-6">
            <h2 className="text-2xl font-bold flex items-center gap-2">
              <CheckCircle size={24} className="text-green-600" />
              Confirmation
            </h2>

            {bookingStatus === "success" ? (
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <h3 className="text-lg font-semibold">Booking Confirmed</h3>
                <p className="text-gray-600 mt-2">
                  Your booking ID is <span id="booking-id">{bookingId}</span>
                </p>

                <div className="mt-4">
                  <p className="text-sm text-gray-600">
                    Summary:
                  </p>
                  <ul className="list-disc ml-5 mt-2">
                    <li>Ship: {formData.ship}</li>
                    <li>Port: {formData.port}</li>
                    <li>Sailing Date: {formData.sailingDate}</li>
                    <li>Guests: {formData.guests}</li>
                    <li>Room: {formData.roomType}</li>
                    <li>Total: ${calculateTotal().toFixed(2)}</li>
                  </ul>
                </div>
              </div>
            ) : (
              <div className="bg-white rounded-xl p-6 shadow-lg">
                <h3 className="text-lg font-semibold">No booking yet</h3>
                <p className="text-gray-600 mt-2">Please complete the flow to confirm your booking.</p>
              </div>
            )}
          </div>
        );

        return (
          <div className="min-h-screen p-8">
            <div className="max-w-6xl mx-auto">
              <header className="flex items-center justify-between mb-8">
                <div className="flex items-center gap-4">
                  <div className="bg-white rounded-full w-12 h-12 flex items-center justify-center">
                    <Ship size={20} className="text-blue-600" />
                  </div>
                  <div>
                    <h1 className="text-2xl font-bold text-white">Greg Book</h1>
                    <p className="text-sm text-white/80">Independent Third-Party Cruise Booking</p>
                  </div>
                </div>

                <nav className="space-x-4">
                  <button
                    className={`px-4 py-2 rounded-lg ${activeTab === "dashboard" ? "bg-white text-gray-800" : "text-white/90"}`}
                    onClick={() => setActiveTab("dashboard")}
                  >
                    Dashboard
                  </button>
                  <button
                    className={`px-4 py-2 rounded-lg ${activeTab === "booking" ? "bg-white text-gray-800" : "text-white/90"}`}
                    onClick={() => {
                      setActiveTab("booking");
                      setCurrentPage("overview");
                    }}
                  >
                    Book a Cruise
                  </button>
                </nav>
              </header>

              <main>
                {activeTab === "dashboard" && <DashboardContent />}

                {activeTab === "booking" && (
                  <div className="bg-white rounded-xl p-8 shadow-lg">
                    <ProgressBar />

                    {currentPage === "overview" && <OverviewPage />}
                    {currentPage === "sailing" && <SailingPage />}
                    {currentPage === "guests" && <GuestsPage />}
                    {currentPage === "payment" && <PaymentPage />}
                    {currentPage === "confirmation" && <ConfirmationPage />}

                    <div className="flex justify-between mt-8">
                      <div>
                        {currentPage !== "overview" && (
                          <button
                            className="px-4 py-2 bg-gray-200 rounded-lg mr-2"
                            onClick={() => {
                              const pages = ["overview", "sailing", "guests", "payment", "confirmation"];
                              const idx = pages.indexOf(currentPage);
                              if (idx > 0) setCurrentPage(pages[idx - 1]);
                            }}
                          >
                            Back
                          </button>
                        )}
                      </div>

                      <div>
                        {currentPage !== "confirmation" && (
                          <button
                            className="px-4 py-2 bg-blue-600 text-white rounded-lg"
                            onClick={() => {
                              const pages = ["overview", "sailing", "guests", "payment", "confirmation"];
                              const idx = pages.indexOf(currentPage);
                              if (canProceed()) {
                                if (idx < pages.length - 1) setCurrentPage(pages[idx + 1]);
                                else handleSubmit();
                              } else {
                                alert("Please complete the required fields to proceed.");
                              }
                            }}
                          >
                            {currentPage === "payment" ? (isSubmitting ? "Processing..." : "Confirm Booking") : "Next"}
                          </button>
                        )}
                      </div>
                    </div>
                  </div>
                )}
              </main>
            </div>
          </div>
        );
      };

      ReactDOM.render(<GregBookCruise />, document.getElementById("root"));
    </script>
  </body>
</html>
